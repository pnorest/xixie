<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>用户管理</title>
    <link rel="stylesheet" type="text/css" href="http://unpkg.com/view-design/dist/styles/iview.css">
    <script type="text/javascript" src="http://vuejs.org/js/vue.min.js"></script>
    <script type="text/javascript" src="http://unpkg.com/view-design/dist/iview.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.1"></script>
    <style>
        .pageClass{
            text-align: right;
        }
    </style>
</head>
<body>
<div id="app">
    <!--<i-button @click="orderList">Click me!</i-button>-->
    <!--<i-button @click="show">Click me!</i-button>-->
    <!--<Modal v-model="visible" title="Welcome">Welcome to ViewUI</Modal>-->
    <h1 style="text-align:center">用户管理</h1>
    <div>
        <p id="search" >
            <input  v-model="searchValue" placeholder="输入用户名进行搜索"   style="width:25%" type="primary"/>
            <i-button type="primary" icon="ios-search" style="width: auto" @click="orderSearch">优惠券查询</i-button>
            <i-button type="primary" icon="ios-add"  @click="addModal = true">新增优惠券</i-button>
        </p>
        <!--<i-input v-model="searchValue" placeholder="输入商品的单号/手机号/用户名进行搜索" type="primary"/>-->
    </div>

    <div>
        <i-table border :columns="historyColumns" :data="historyData">
            <div slot-scope="{ row }" slot="name">
                <strong>{{ row.name }}</strong>
            </div>
            <div slot-scope="{ row, index }" slot="action">
                <i-button type="primary" size="small" style="margin-right: 5px" @click="show(index)">查看</i-button>
                <i-button type="primary" size="small" @click="updateModal = true">修改</i-button>
            </div>
        </i-table>

    </div>
    <div class="pageClass">
        <Page :total="dataCount" :page-size="pageSize" show-total   @on-change="changepage"></Page>

    </div>

    <div>
        <Modal v-model="addModal" title="优惠券信息新增" >
            <div>

                <i-form :model="addFormItem" :label-width="120">
                    <p>
                        <FormItem label="优惠券金额">
                            <i-input v-model="addFormItem.input" placeholder="优惠券金额"></i-input>
                        </FormItem>
                    </p>
                    <p>
                        <FormItem label="优惠券名称">
                            <i-input v-model="addFormItem.input2" placeholder="优惠券名称"></i-input>
                        </FormItem>
                    </p>
                    <p>
                        <FormItem label="优惠券状态">
                            <i-select v-model="addFormItem.select">
                                <i-option value="1">可使用</i-option>
                                <i-option value="0">不可用</i-option>
                            </i-select>
                        </FormItem>
                    </p>
                    <p>
                        <FormItem label="用户id">
                            <i-input v-model="addFormItem.textarea"  :autosize="{minRows: 2,maxRows: 5}" placeholder="用户id ..."></i-input>
                        </FormItem>
                    </p>
                </i-form>
            </div>
        </Modal>

    </div>

    <div>
        <Modal v-model="updateModal" title="优惠券信息修改" okText="修改">
            <div>

                <i-form :model="formItem" :label-width="120">
                    <p>
                        <FormItem label="优惠券金额">
                            <i-input v-model="formItem.input" placeholder="优惠券金额"></i-input>
                        </FormItem>
                    </p>
                    <p>
                        <FormItem label="优惠券名称">
                            <i-input v-model="formItem.input2" placeholder="优惠券名称"></i-input>
                        </FormItem>
                    </p>
                    <p>
                        <FormItem label="优惠券状态">
                            <i-select v-model="formItem.select">
                                <i-option value="1">可使用</i-option>
                                <i-option value="0">不可用</i-option>
                            </i-select>
                        </FormItem>
                    </p>
                    <p>
                        <FormItem label="用户id">
                            <i-input v-model="formItem.textarea"  :autosize="{minRows: 2,maxRows: 5}" placeholder="用户id ..."></i-input>
                        </FormItem>
                    </p>
                </i-form>
            </div>
        </Modal>
    </div>
</div>
<script>
    new Vue({
        el: '#app',
        data: {
            addFormItem: {
                input: '',
                input2: '',
                select: '',
                textarea: ''
            },
            formItem: {
                input: '',
                input2: '',
                select: '',
                textarea: ''
            },
            updateModal: false,
            addModal: false,
            searchValue: '',
            ajaxHistoryData:[],
            // 初始化信息总条数
            dataCount:0,
            // 每页显示多少条
            pageSize:10,
            historyColumns: [
                {
                    title: '优惠券id',
                    key: 'id'
                },
                {
                    title: '价格',
                    key: 'price'
                },
                {
                    title: '优惠券名称',
                    key: 'name'
                },
                {
                    title: '服务类型',
                    key: 'type'
                },
                {
                    title: '创建时间',
                    key: 'createTime'
                },
                {
                    title: '优惠券状态',
                    key: 'status'
                },
                {
                    title: '使用时间',
                    key: 'useTime'
                },
                {
                    title: '用户姓名',
                    key: 'userId'
                },
                {
                    title: 'Action',
                    slot: 'action',
                    width: 150,
                    align: 'center'
                }
            ],

            historyData: []

        },
        // mounted(){
        //     this.orderList()
        // },
        created(){
            this.orderList();
        },
        methods: {
            orderSearch() {
                if (this.searchValue.split(" ").join("").length === 0){
                    this.orderList();
                }else {
                    this.$http.get('/queryCouponListByUser',{params:{searchValue: this.searchValue}}).then(function (response) {
                        this.ajaxHistoryData=response.body;
                        for (let i = 0;i<this.ajaxHistoryData.length;i++){
                            // let obj = this.ajaxHistoryData[i];
                            this.ajaxHistoryData[i].status=this.ajaxHistoryData[i].status==0?"可使用":"不可使用";//0清洗  1修复
                            this.ajaxHistoryData[i].createTime=this.myTime(this.ajaxHistoryData[i].createTime);
                            this.ajaxHistoryData[i].useTime=this.myTime(this.ajaxHistoryData[i].useTime);
                            console.log("this.ajaxHistoryData[i].type"+this.ajaxHistoryData[i].type)
                            if(this.ajaxHistoryData[i].type==0){
                                this.ajaxHistoryData[i].type="通用";
                            }else if(this.ajaxHistoryData[i].type==1){
                                this.ajaxHistoryData[i].type="清洗";

                            }else {
                                this.ajaxHistoryData[i].type="修复";
                            }


                        }

                        this.dataCount = response.body.length;
                        // 初始化显示，小于每页显示条数，全显，大于每页显示条数，取前每页条数显示
                        if(response.body.length < this.pageSize){
                            this.historyData = this.ajaxHistoryData;
                        }else{
                            this.historyData = this.ajaxHistoryData.slice(0,this.pageSize);
                        }

                    });
                }

            },
            orderList () {
                this.$http.get('/queryCouponList').then(function (response) {
                    this.ajaxHistoryData=response.body;
                    for (let i = 0;i<this.ajaxHistoryData.length;i++){
                        // let obj = this.ajaxHistoryData[i];
                        this.ajaxHistoryData[i].status=this.ajaxHistoryData[i].status==0?"可使用":"不可使用";//0清洗  1修复
                        this.ajaxHistoryData[i].createTime=this.myTime(this.ajaxHistoryData[i].createTime);
                        this.ajaxHistoryData[i].useTime=this.myTime(this.ajaxHistoryData[i].useTime);
                        console.log("this.ajaxHistoryData[i].type"+this.ajaxHistoryData[i].type)
                        if(this.ajaxHistoryData[i].type==0){
                            this.ajaxHistoryData[i].type="通用";
                        }else if(this.ajaxHistoryData[i].type==1){
                            this.ajaxHistoryData[i].type="清洗";

                        }else {
                            this.ajaxHistoryData[i].type="修复";
                        }


                    }
                    this.dataCount = response.body.length;
                    // 初始化显示，小于每页显示条数，全显，大于每页显示条数，取前每页条数显示
                    if(response.body.length < this.pageSize){
                        this.historyData = this.ajaxHistoryData;
                    }else{
                        this.historyData = this.ajaxHistoryData.slice(0,this.pageSize);
                    }

                });
            },

            changepage(index){
                var _start = ( index - 1 ) * this.pageSize;
                var _end = index * this.pageSize;
                this.historyData = this.ajaxHistoryData.slice(_start,_end);
            },
            show (index) {
                this.$Modal.info({
                    title: '优惠券信息',
                    content: `优惠券号：${this.historyData[index].id}<br>优惠券金额：${this.historyData[index].price}<br>订单状态：${this.historyData[index].status}`
                })
            },
            remove (index) {
                this.historyData.splice(index, 1);
            },

            myTime(date){
                var d = new Date(date);
                var times=d.getFullYear() + '-' + (d.getMonth() + 1) + '-' + d.getDate() + ' ' + d.getHours() + ':' + d.getMinutes() + ':' + d.getSeconds();
                return times;
            },

            //提交新增优惠券信息
            // addCoupon


        }
    })
</script>
</body>
</html>